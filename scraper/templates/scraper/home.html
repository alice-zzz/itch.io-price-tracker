{% extends "scraper/base.html" %}
{% block title %}Itch.io Price Tracker{% endblock %}
{% block content %}
{% load static %}

<body>
    <h1>Itch.io Price Tracker</h1>

    <div class="welcome">
        <p>Weclome back!</p>

    <img src="{% static 'scraper/diamond.gif' %}" alt="Pixel shining diamond gif">
    </div>
    
    <div class="add-game">
        <form action="{% url 'add_game' %}" method="post">
            {% csrf_token %}
            <input type="url" name="url" placeholder="Itch.io Game URL" required>
            <button type="submit">Add Game</button>
        </form>
    </div>

    <div class="scrape-now">
        <form action="{% url 'scrape_all_now' %}" method="post">
            {% csrf_token %}
            <button type="submit">Scrape All Now</button>
        </form>
    </div>

    <div class="games-list">
        <h2>Currently tracking...</h2>
        {% if games %}
            <ul>
            {% for game in games %}
                <li>
                    <a href="{% url 'game_detail' game.pk %}" class="game-title">{{ game.title }}</a><br>
            
                    {% if game.prices.exists %}
                        {% with latest=game.prices.first %}
                            <div class="discount"><mark>
                                {% if latest.discount %}
                                    Discount: {{ latest.discount }}% <br>
                                {% endif %}</mark>
                            </div>

                            Current Price: <mark>${{ latest.current_price|floatformat:2 }}</mark> 

                            {% if latest.original_price and latest.original_price != latest.current_price %}
                                (was ${{ latest.original_price|floatformat:2 }})
                            {% endif %}<br>

                            <span class="last-checked">Last Checked: {{ latest.date_checked }}</span>
                        {% endwith %}
                    {% else %}
                        No price data yet.
                    {% endif %}
                    

                </li>
            {% endfor %}
            </ul>
            
        {% else %}
            <p>No games tracked yet.</p>
        {% endif %}
    </div>
</body>

{% endblock %}
